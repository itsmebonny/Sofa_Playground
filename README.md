# Repository containing the code developed during the internship in the MIMESIS team at Inria Strasbourg

## The code serves four main purposes

1. **Data generation**: each one of the folders named `simulation_xxxx` contains the scripts needed to interface with SOFA and generate the data.
2. **Data processing**: the `data_management` folder contains the scripts needed to process the data generated by the simulations. (Unless the simulation is dynamic, the only thing needed is to run the `data_management/data_manager.py` script, changing the `path` variable to the path of the data to be processed).
3. **Network training**: the `network` folder contains the scripts needed to train the neural network. Each network is named as `XXX_Error_estimation.py`, where `XXX` is the name of the network (e.g. `CNN` stands for Convolutional Neural Network, `FC` stands for Fully Connected, etc.). In the `main` section of the script `network/XXX_Error_estimation.py` must be changed the `data_dir` variable to the path of the data to be used for training. (THE DATA MUST BE PROCESSED BEFORE TRAINING).
4. **Network evaluation**: each one of the simulation folders contains the scripts needed to evaluate the network. The script `simulation_xxxx/prediction_topology_free.py` is used to evaluate the network. To do so in the `__init__` method of the `AnimationStepController` class there is a variable called `network` that must be changed to the path of the data used for the training. After a few lines there is the `self.network.load_model()` method that must be changed to the path of the model trained.

## Requirements

- SOFA v23.06
- Pytorch
- Numpy
- Matplotlib
- Scipy
- and probably more that I forgot to mention.

## Important things

- In the `network/XXX_Error_estimation.py` scripts, the class `ScaleInvariantLoss` is used as the loss function. This loss is custom made by creating a synthetic symmetric logarithm function and then computing the mean squared error between the logarithm of the prediction and the logarithm of the target.
- The interesting simulation scripts are either called `xxx_topology_free.py` or `xxx_symmetric.py`. The first one is used to generate the data from a cantilever beam fixed at one end and free at the other. The second one is used to generate the data from a cantilever beam fixed in the middle with a symmetric load applied at the free ends.
- There is a whole section about Graph Neural Network for the dynamic case but at the moment it is not working properly. The best result on that end are found in the `data_management/GNN_testing.ipynb` notebook.
